name: Notify PR Event

on:
  pull_request:
    types: [opened, edited]
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send repository_dispatch to project-agent
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/repos/storacha/project-agent/dispatches \
            -d "{\"event_type\":\"pr-event\",\"client_payload\":{\"pr_repo\":\"${{ github.repository }}\",\"pr_number\":${{ github.event.pull_request.number }},\"pr_title\":$(echo '${{ github.event.pull_request.title }}' | jq -Rs .),\"pr_body\":$(echo '${{ github.event.pull_request.body }}' | jq -Rs .)}}"
